
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ジャンル選択ビューア ver3.3</title>
</head>
<body>
    <h1>ジャンル選択ビューア（ver3.3）</h1>

    <label for="startMonth">開始月（例：202205）:</label>
    <input type="text" id="startMonth" placeholder="YYYYMM">
    <label for="endMonth">終了月（例：202509）:</label>
    <input type="text" id="endMonth" placeholder="YYYYMM">
    <br><br>

    <label for="genreSelect">ジャンルを選択:</label>
    <select id="genreSelect">
        <option value="">-- ジャンルを選んでください --</option>
    </select>
    <br><br>

    <button onclick="loadData()">表示</button>
    <pre id="output"></pre>

    <script src="genre_map.full.fixed.js"></script>
    <script>
        function populateGenres() {
            if (typeof genreMap !== 'undefined') {
                const genreSelect = document.getElementById("genreSelect");
                Object.keys(genreMap).forEach(japanese => {
                    const option = document.createElement("option");
                    option.value = genreMap[japanese];
                    option.textContent = japanese;
                    genreSelect.appendChild(option);
                });
            } else {
                console.error("genreMap is not loaded correctly.");
            }
        }

        async function loadData() {
            const genre = document.getElementById("genreSelect").value;
            const startMonth = document.getElementById("startMonth").value;
            const endMonth = document.getElementById("endMonth").value;

            if (!genre || !startMonth || !endMonth) {
                document.getElementById("output").textContent = "すべての項目を入力してください。";
                return;
            }

            let output = "";
            for (let ym = parseInt(startMonth); ym <= parseInt(endMonth);) {
                const url = `https://netshopstudio-nk.github.io/example-upload/data/${genre}_${ym}.csv`;
                try {
                    const res = await fetch(url);
                    if (!res.ok) {
                        output += `❌ ${ym}: データが見つかりませんでした (${url})
`;
                    } else {
                        const text = await res.text();
                        output += `✅ ${ym}: データ取得成功 (${url})
`;
                    }
                } catch (e) {
                    output += `⚠️ ${ym}: エラーが発生しました
`;
                }

                // 月を進める
                let year = Math.floor(ym / 100);
                let month = ym % 100;
                month++;
                if (month > 12) {
                    year++;
                    month = 1;
                }
                ym = year * 100 + month;
            }

            document.getElementById("output").textContent = output;
        }

        window.onload = populateGenres;
    </script>
</body>
</html>
