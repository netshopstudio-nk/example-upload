
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ジャンル選択ビューア（ver3.4）</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    select, input { margin: 5px; }
    .error { color: red; }
  </style>
  <script src="genre_map.full.js"></script>
</head>
<body>
  <h1>ジャンル選択ビューア（ver3.4）</h1>
  <div>
    開始月（例：202205）：<input type="text" id="startMonth" value="202205">
    終了月（例：202509）：<input type="text" id="endMonth" value="202502">
  </div>
  <div>
    ジャンルを選択:
    <select id="genreSelect">
      <option value="">-- ジャンルを選んでください --</option>
    </select>
  </div>
  <button onclick="loadData()">表示</button>
  <div id="result"></div>

  <script>
    function populateGenres() {
      const select = document.getElementById("genreSelect");
      if (typeof genreMap !== "object") {
        console.error("genreMap is not loaded correctly.");
        return;
      }

      const entries = Object.entries(genreMap).sort((a, b) => a[0].localeCompare(b[0]));
      for (const [ja, en] of entries) {
        const option = document.createElement("option");
        option.value = en;
        option.textContent = ja;
        select.appendChild(option);
      }
    }

    async function loadData() {
      const genreKey = document.getElementById("genreSelect").value;
      const startMonth = parseInt(document.getElementById("startMonth").value);
      const endMonth = parseInt(document.getElementById("endMonth").value);
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (!genreKey || isNaN(startMonth) || isNaN(endMonth)) {
        resultDiv.innerHTML = "<p class='error'>ジャンルと月を正しく指定してください。</p>";
        return;
      }

      for (let ym = startMonth; ym <= endMonth; ) {
        const url = `https://netshopstudio-nk.github.io/example-upload/data/${genreKey}_${ym}.csv`;
        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error("データが見つかりませんでした");
          const text = await res.text();
          resultDiv.innerHTML += `<p>✅ ${ym}: データ取得成功</p>`;
        } catch (e) {
          resultDiv.innerHTML += `<p class='error'>❌ ${ym}: データが見つかりませんでした (${url})</p>`;
        }

        let year = Math.floor(ym / 100), month = ym % 100;
        month++;
        if (month > 12) { month = 1; year++; }
        ym = year * 100 + month;
      }
    }

    window.onload = populateGenres;
  </script>
</body>
</html>
